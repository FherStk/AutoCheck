/*
    Copyright Â© 2023 Fernando Porrino Serrano
    Third party software licenses can be found at /docs/credits/credits.md

    This file is part of AutoCheck.

    AutoCheck is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    AutoCheck is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with AutoCheck.  If not, see <https://www.gnu.org/licenses/>.
*/

using System.Collections.Generic;
using NUnit.Framework;

namespace AutoCheck.Test.Real
{    
    [Parallelizable(ParallelScope.All)]    
    public class WebSyndication : Test
    { 
        public WebSyndication(): base("script/real"){
        }        

        [Test, Category("FullScriptWebSyndication"), Category("Real"), Category("Local")]
        public void Real_WEB_SYNDICATION_SINGLE_NO_ERRORS()
        {             
            var s = new AutoCheck.Core.Script(GetScriptFile(Core.Script.ExecutionMode.SINGLE, "web_syndication.yaml"), false);
            s.OverrideTarget(new Dictionary<string, string>(){ {"folder", "{$APP_FOLDER_PATH}/../test/samples/private/web_syndication/Student Name 1"} });
            s.Start();

            Assert.AreEqual("Running script DAM - M04 (UF2): Web Syndication (RSS + Atom) (v1.0.0.2):\r\nRunning on single mode:\r\n   Question 1 [1.8 points] - Checking document.rss:\r\n      Looking for document.rss... OK\r\n      Loading document.rss... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 1.1 [0.15 points] - Validating rss tag:\r\n         Checking amount of rss tags... OK\r\n\r\n      Question 1.2 [0.15 points] - Validating channel tag:\r\n         Checking amount of channel tags... OK\r\n\r\n      Question 1.3 [0.15 points] - Validating item tag:\r\n         Checking amount of items... OK\r\n\r\n      Question 1.4 [0.15 points] - Validating title (within channel) tag:\r\n         Checking amount of titles... OK\r\n\r\n      Question 1.5 [0.15 points] - Validating title (within item) tag:\r\n         Checking amount of titles... OK\r\n\r\n      Question 1.6 [0.15 points] - Validating description (within channel) tag:\r\n         Checking amount of descriptions... OK\r\n\r\n      Question 1.7 [0.15 points] - Validating description (within item) tag:\r\n         Checking amount of descriptions... OK\r\n\r\n      Question 1.8 [0.15 points] - Validating link (within channel) tag:\r\n         Checking amount of links... OK\r\n\r\n      Question 1.9 [0.15 points] - Validating link (within item) tag:\r\n         Checking amount of links... OK\r\n\r\n      Question 1.10 [0.15 points] - Validating pubdate (within channel) tag:\r\n         Checking amount of pubdates... OK\r\n\r\n      Question 1.11 [0.15 points] - Validating pubdate (within item) tag:\r\n         Checking amount of pubdates... OK\r\n\r\n      Question 1.12 [0.15 points] - Validating guid (within item) tag:\r\n         Checking amount of guids... OK\r\n\r\n   Question 2 [1.65 points] - Checking document.atom:\r\n      Looking for document.atom... OK\r\n      Loading document.atom... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 2.1 [0.15 points] - Validating feed tag:\r\n         Checking amount of feed tags... OK\r\n\r\n      Question 2.2 [0.15 points] - Validating entry tag:\r\n         Checking amount of entries... OK\r\n\r\n      Question 2.3 [0.15 points] - Validating title (within feed) tag:\r\n         Checking amount of titles... OK\r\n\r\n      Question 2.4 [0.15 points] - Validating title (within entry) tag:\r\n         Checking amount of titles... OK\r\n\r\n      Question 2.5 [0.15 points] - Validating subtitle (within feed) tag:\r\n         Checking amount of subtitles... OK\r\n\r\n      Question 2.6 [0.15 points] - Validating summary (within entry) tag:\r\n         Checking amount of summaries... OK\r\n\r\n      Question 2.7 [0.15 points] - Validating link (within feed) tag:\r\n         Checking amount of links... OK\r\n\r\n      Question 2.8 [0.15 points] - Validating link (within entry) tag:\r\n         Checking amount of links... OK\r\n\r\n      Question 2.9 [0.15 points] - Validating updated (within feed) tag:\r\n         Checking amount of updateds... OK\r\n\r\n      Question 2.10 [0.15 points] - Validating updated (within entry) tag:\r\n         Checking amount of updateds... OK\r\n\r\n      Question 2.11 [0.15 points] - Validating id (within entry) tag:\r\n         Checking amount of ids... OK\r\n\r\n   TOTAL SCORE: 3.45 / 3.45", s.Output.ToString());
        }

        [Test, Category("FullScriptWebSyndication"), Category("Real"), Category("Local")]
        public void Real_WEB_SYNDICATION_SINGLE_SOME_ERRORS()
        {             
            var s = new AutoCheck.Core.Script(GetScriptFile(Core.Script.ExecutionMode.SINGLE, "web_syndication.yaml"), false);
            s.OverrideTarget(new Dictionary<string, string>(){ {"folder", "{$APP_FOLDER_PATH}/../test/samples/private/web_syndication/Student Name 2"} });
            s.Start();

            Assert.AreEqual("Running script DAM - M04 (UF2): Web Syndication (RSS + Atom) (v1.0.0.2):\r\nRunning on single mode:\r\n   Question 1 [1.8 points] - Checking document.rss:\r\n      Looking for document.rss... OK\r\n      Loading document.rss... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 1.1 [0.15 points] - Validating rss tag:\r\n         Checking amount of rss tags... OK\r\n\r\n      Question 1.2 [0.15 points] - Validating channel tag:\r\n         Checking amount of channel tags... OK\r\n\r\n      Question 1.3 [0.15 points] - Validating item tag:\r\n         Checking amount of items... ERROR:\n            -Expected -> >=3; Found -> 2\r\n\r\n      Question 1.4 [0.15 points] - Validating title (within channel) tag:\r\n         Checking amount of titles... OK\r\n\r\n      Question 1.5 [0.15 points] - Validating title (within item) tag:\r\n         Checking amount of titles... OK\r\n\r\n      Question 1.6 [0.15 points] - Validating description (within channel) tag:\r\n         Checking amount of descriptions... OK\r\n\r\n      Question 1.7 [0.15 points] - Validating description (within item) tag:\r\n         Checking amount of descriptions... OK\r\n\r\n      Question 1.8 [0.15 points] - Validating link (within channel) tag:\r\n         Checking amount of links... OK\r\n\r\n      Question 1.9 [0.15 points] - Validating link (within item) tag:\r\n         Checking amount of links... OK\r\n\r\n      Question 1.10 [0.15 points] - Validating pubdate (within channel) tag:\r\n         Checking amount of pubdates... OK\r\n\r\n      Question 1.11 [0.15 points] - Validating pubdate (within item) tag:\r\n         Checking amount of pubdates... OK\r\n\r\n      Question 1.12 [0.15 points] - Validating guid (within item) tag:\r\n         Checking amount of guids... OK\r\n\r\n   Question 2 [1.65 points] - Checking document.atom:\r\n      Looking for document.atom... OK\r\n      Loading document.atom... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 2.1 [0.15 points] - Validating feed tag:\r\n         Checking amount of feed tags... OK\r\n\r\n      Question 2.2 [0.15 points] - Validating entry tag:\r\n         Checking amount of entries... OK\r\n\r\n      Question 2.3 [0.15 points] - Validating title (within feed) tag:\r\n         Checking amount of titles... OK\r\n\r\n      Question 2.4 [0.15 points] - Validating title (within entry) tag:\r\n         Checking amount of titles... OK\r\n\r\n      Question 2.5 [0.15 points] - Validating subtitle (within feed) tag:\r\n         Checking amount of subtitles... OK\r\n\r\n      Question 2.6 [0.15 points] - Validating summary (within entry) tag:\r\n         Checking amount of summaries... OK\r\n\r\n      Question 2.7 [0.15 points] - Validating link (within feed) tag:\r\n         Checking amount of links... OK\r\n\r\n      Question 2.8 [0.15 points] - Validating link (within entry) tag:\r\n         Checking amount of links... OK\r\n\r\n      Question 2.9 [0.15 points] - Validating updated (within feed) tag:\r\n         Checking amount of updateds... OK\r\n\r\n      Question 2.10 [0.15 points] - Validating updated (within entry) tag:\r\n         Checking amount of updateds... OK\r\n\r\n      Question 2.11 [0.15 points] - Validating id (within entry) tag:\r\n         Checking amount of ids... OK\r\n\r\n   TOTAL SCORE: 3.3 / 3.45", s.Output.ToString());
        }
       
        [Test, Category("FullScriptWebSyndication"), Category("Real"), Category("Local")]
        public void Real_WEB_SYNDICATION_SCRIPT_BATCH()
        {             
            var s = new AutoCheck.Core.Script(GetScriptFile(Core.Script.ExecutionMode.BATCH, "web_syndication.yaml"), false);
            s.OverrideTarget(new Dictionary<string, string>(){ {"path", "{$APP_FOLDER_PATH}/../test/samples/private/web_syndication"} });
            s.Start();

            var expected = "Running script DAM - M04 (UF2): Web Syndication (RSS + Atom) (v1.0.0.2):\r\n   Extracting files at: Student Name 1\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 2\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 3\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 4\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n\r\nRunning on batch mode for Student Name 1:\r\n   Potential copy detected for Student Name 1/document.rss:\r\n      Match score with Student Name 2/document.rss... 71,93 %\r\n      Match score with Student Name 3/document.rss... 100,00 %\r\n      Match score with Student Name 4/document.rss... 88,05 %\r\n\r\n   Potential copy detected for Student Name 1/document.atom:\r\n      Match score with Student Name 2/document.atom... 100,00 %\r\n      Match score with Student Name 3/document.atom... 88,38 %\r\n      Match score with Student Name 4/document.atom... 68,25 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF2): Web Syndication (RSS + Atom) (v1.0.0.2):\r\n   Extracting files at: Student Name 1\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 2\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 3\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 4\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n\r\nRunning on batch mode for Student Name 2:\r\n   No potential copy detected for Student Name 2/document.rss:\r\n      Match score with Student Name 1/document.rss... 71,93 %\r\n      Match score with Student Name 3/document.rss... 71,93 %\r\n      Match score with Student Name 4/document.rss... 72,14 %\r\n\r\n   Potential copy detected for Student Name 2/document.atom:\r\n      Match score with Student Name 1/document.atom... 100,00 %\r\n      Match score with Student Name 3/document.atom... 88,38 %\r\n      Match score with Student Name 4/document.atom... 68,25 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF2): Web Syndication (RSS + Atom) (v1.0.0.2):\r\n   Extracting files at: Student Name 1\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 2\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 3\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 4\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n\r\nRunning on batch mode for Student Name 3:\r\n   Potential copy detected for Student Name 3/document.rss:\r\n      Match score with Student Name 1/document.rss... 100,00 %\r\n      Match score with Student Name 2/document.rss... 71,93 %\r\n      Match score with Student Name 4/document.rss... 88,05 %\r\n\r\n   Potential copy detected for Student Name 3/document.atom:\r\n      Match score with Student Name 1/document.atom... 88,38 %\r\n      Match score with Student Name 2/document.atom... 88,38 %\r\n      Match score with Student Name 4/document.atom... 66,44 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF2): Web Syndication (RSS + Atom) (v1.0.0.2):\r\n   Extracting files at: Student Name 1\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 2\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 3\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 4\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n\r\nRunning on batch mode for Student Name 4:\r\n   Potential copy detected for Student Name 4/document.rss:\r\n      Match score with Student Name 1/document.rss... 88,05 %\r\n      Match score with Student Name 2/document.rss... 72,14 %\r\n      Match score with Student Name 3/document.rss... 88,05 %\r\n\r\n   No potential copy detected for Student Name 4/document.atom:\r\n      Match score with Student Name 1/document.atom... 68,25 %\r\n      Match score with Student Name 2/document.atom... 68,25 %\r\n      Match score with Student Name 3/document.atom... 66,44 %\r\n\r\n   Script execution aborted due potential copy detection.";
            Assert.AreEqual(expected, s.Output.ToString());
        }
    }
}