/*
    Copyright Â© 2022 Fernando Porrino Serrano
    Third party software licenses can be found at /docs/credits/credits.md

    This file is part of AutoCheck.

    AutoCheck is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    AutoCheck is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with AutoCheck.  If not, see <https://www.gnu.org/licenses/>.
*/

using System.Collections.Generic;
using NUnit.Framework;

namespace AutoCheck.Test.Real
{    
    [NonParallelizable]   //W3C Validation will report a 507 error when running in parallel 
    public class Html5 : Test
    { 
        public Html5(): base("script/real"){
        }        

        [NonParallelizable]
        [Test, Category("FullScriptHtml5"), Category("Real"), Category("Local")]
        [TestCase(1)]
        [TestCase(3)]        
        public void Real_HTML5_Single_NO_ERRORS(int test) 
        {             
            var s = new AutoCheck.Core.Script(GetScriptFile(Core.Script.ExecutionMode.SINGLE, "html5.yaml"), false);
            s.OverrideTarget(new Dictionary<string, string>(){ {"folder", "{$APP_FOLDER_PATH}/samples/private/html5/Student Name " + test} });
            s.Start();
            
            Assert.AreEqual("Running script DAM - M04 (UF1): HTML5 Assignment (v1.0.0.2):\r\nRunning on single mode:\r\n   Question 1 [4 points] - Checking index.html:\r\n      Looking for index.html... OK\r\n      Loading index.html... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 1.1 [1 point] - Validating headers:\r\n         Checking amount of level-1 headers... OK\r\n         Checking amount of level-2 headers... OK\r\n\r\n      Question 1.2 [1 point] - Validating paragraphs:\r\n         Checking amount of paragraphs... OK\r\n         Checking content legth within paragraphs... OK\r\n\r\n      Question 1.3 [1 point] - Validating breaklines:\r\n         Checking amount of breaklines within a paragraph... OK\r\n\r\n      Question 1.4 [1 point] - Validating images:\r\n         Checking amount of images... OK\r\n\r\n   Question 2 [12 points] - Checking contacte.html:\r\n      Looking for contacte.html... OK\r\n      Loading contacte.html... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 2.1 [1 point] - Validating text fields:\r\n         Checking amount of text fields... OK\r\n\r\n      Question 2.2 [1 point] - Validating numeric fields:\r\n         Checking amount of numeric fields... OK\r\n\r\n      Question 2.3 [1 point] - Validating email fields:\r\n         Checking amount of email fields... OK\r\n\r\n      Question 2.4 [1 point] - Validating radio fields:\r\n         Checking amount of radio fields... OK\r\n         Checking group for the radio fields... OK\r\n         Checking the checked radio fields... OK\r\n\r\n      Question 2.5 [1 point] - Validating select fields:\r\n         Checking amount of select fields... OK\r\n         Checking select options... OK\r\n         Checking the selected option... OK\r\n\r\n      Question 2.6 [1 point] - Validating checkbox fields:\r\n         Checking amount of checkbox fields... OK\r\n         Checking group for the checkbox fields... OK\r\n         Checking the checked option... OK\r\n\r\n      Question 2.7 [1 point] - Validating textarea fields:\r\n         Checking amount of textarea fields... OK\r\n\r\n      Question 2.8 [1 point] - Validating placeholders:\r\n         Checking amount of placelhoders for text fields... OK\r\n         Checking amount of placelhoders for email fields... OK\r\n         Checking amount of placelhoders for numeric fields... OK\r\n         Checking amount of placelhoders for textarea fields... OK\r\n\r\n      Question 2.9 [1 point] - Validating labels:\r\n         Checking amount of labels for text fields... OK\r\n         Checking amount of labels for numeric fields... OK\r\n         Checking amount of labels for email fields... OK\r\n         Checking amount of labels for radio fields... OK\r\n         Checking amount of labels for select fields... OK\r\n         Checking amount of labels for check fields... OK\r\n         Checking amount of labels for textarea fields... OK\r\n\r\n      Question 2.10 [1 point] - Validating table:\r\n         Checking amount of columns... OK\r\n         Checking amount of merged columns... OK\r\n         Checking amount of labels within the first column... OK\r\n         Checking amount of labels within the second column... OK\r\n         Checking amount of labels within the third column... OK\r\n         Checking amount of labels within the fourth column... OK\r\n         Checking table's consistency... OK\r\n\r\n      Question 2.11 [1 point] - Validating form reset:\r\n         Checking amount of reset buttons... OK\r\n\r\n      Question 2.12 [1 point] - Validating form submit:\r\n         Checking amount of fields with no name... OK\r\n         Checking amount of submit buttons... OK\r\n         Checking form action... OK\r\n\r\n   Question 3 [2 points] - Checking menu (index.html):\r\n      Loading index.html... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 3.1 [1 point] - Validating lists:\r\n         Checking amount of lists... OK\r\n         Checking amount of list items... OK\r\n\r\n      Question 3.2 [1 point] - Validating links:\r\n         Checking amount of links... OK\r\n         Checking links destination... OK\r\n\r\n   TOTAL SCORE: 10 / 10", s.Output.ToString());            
        }  

        [NonParallelizable]
        [Test, Category("FullScriptHtml5"), Category("Real"), Category("Local")]
        public void Real_HTML5_Single_ALL_ERRORS()
        {             
            var s = new AutoCheck.Core.Script(GetScriptFile(Core.Script.ExecutionMode.SINGLE, "html5.yaml"), false);
            s.OverrideTarget(new Dictionary<string, string>(){ {"folder", "{$APP_FOLDER_PATH}/samples/private/html5/Student Name 2"} });
            s.Start();

            var expected = "Running script DAM - M04 (UF1): HTML5 Assignment (v1.0.0.2):\r\nRunning on single mode:\r\n   Question 1 [4 points] - Checking index.html:\r\n      Looking for index.html... OK\r\n      Loading index.html... OK\r\n      Validating document against the W3C validation service... ERROR:\n         -Duplicate attribute alt.ight=\"333\"  alt=\"Cavs\">\r\n\r\n   Question 2 [12 points] - Checking contacte.html:\r\n      Looking for contacte.html... OK\r\n      Loading contacte.html... OK\r\n      Validating document against the W3C validation service... ERROR:\n         -Stray end tag label. teu nom\"></label></td>\r\n\r\n   Question 3 [2 points] - Checking menu (index.html):\r\n      Loading index.html... OK\r\n      Validating document against the W3C validation service... ERROR:\n         -Duplicate attribute alt.ight=\"333\"  alt=\"Cavs\">\r\n\r\n   TOTAL SCORE: 0 / 10";
            Assert.AreEqual(expected, s.Output.ToString());            
        }  
        
        [NonParallelizable]
        [Test, Category("FullScriptHtml5"), Category("Real"), Category("Local")]
        public void Real_HTML5_SCRIPT_BATCH_1()
        {           
            //Testing the previous ones but in batch (if more test are needed, could be tested here in order to optimize)    
            var s = new AutoCheck.Core.Script(GetScriptFile(Core.Script.ExecutionMode.BATCH, "html5.yaml"), false);
            s.OverrideTarget(new Dictionary<string, string>(){ {"path", "{$APP_FOLDER_PATH}/samples/private/html5"} });
            s.Start();

            var expected = "Running script DAM - M04 (UF1): HTML5 Assignment (v1.0.0.2):\r\n   Extracting files at: Student Name 1\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 2\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 3\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Starting the copy detector for HTML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n\r\n   Starting the copy detector for HTML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n\r\nRunning on batch mode for Student Name 1:\r\n   No potential copy detected for Student Name 1/index.html:\r\n      Match score with Student Name 2/index.html... 39,58 %\r\n      Match score with Student Name 3/index.html... 46,63 %\r\n\r\n   No potential copy detected for Student Name 1/contacte.html:\r\n      Match score with Student Name 2/contacte.html... 51,37 %\r\n      Match score with Student Name 3/contacte.html... 57,91 %\r\n\r\n   No potential copy has been detected.\r\n\r\n   Question 1 [4 points] - Checking index.html:\r\n      Looking for index.html... OK\r\n      Loading index.html... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 1.1 [1 point] - Validating headers:\r\n         Checking amount of level-1 headers... OK\r\n         Checking amount of level-2 headers... OK\r\n\r\n      Question 1.2 [1 point] - Validating paragraphs:\r\n         Checking amount of paragraphs... OK\r\n         Checking content legth within paragraphs... OK\r\n\r\n      Question 1.3 [1 point] - Validating breaklines:\r\n         Checking amount of breaklines within a paragraph... OK\r\n\r\n      Question 1.4 [1 point] - Validating images:\r\n         Checking amount of images... OK\r\n\r\n   Question 2 [12 points] - Checking contacte.html:\r\n      Looking for contacte.html... OK\r\n      Loading contacte.html... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 2.1 [1 point] - Validating text fields:\r\n         Checking amount of text fields... OK\r\n\r\n      Question 2.2 [1 point] - Validating numeric fields:\r\n         Checking amount of numeric fields... OK\r\n\r\n      Question 2.3 [1 point] - Validating email fields:\r\n         Checking amount of email fields... OK\r\n\r\n      Question 2.4 [1 point] - Validating radio fields:\r\n         Checking amount of radio fields... OK\r\n         Checking group for the radio fields... OK\r\n         Checking the checked radio fields... OK\r\n\r\n      Question 2.5 [1 point] - Validating select fields:\r\n         Checking amount of select fields... OK\r\n         Checking select options... OK\r\n         Checking the selected option... OK\r\n\r\n      Question 2.6 [1 point] - Validating checkbox fields:\r\n         Checking amount of checkbox fields... OK\r\n         Checking group for the checkbox fields... OK\r\n         Checking the checked option... OK\r\n\r\n      Question 2.7 [1 point] - Validating textarea fields:\r\n         Checking amount of textarea fields... OK\r\n\r\n      Question 2.8 [1 point] - Validating placeholders:\r\n         Checking amount of placelhoders for text fields... OK\r\n         Checking amount of placelhoders for email fields... OK\r\n         Checking amount of placelhoders for numeric fields... OK\r\n         Checking amount of placelhoders for textarea fields... OK\r\n\r\n      Question 2.9 [1 point] - Validating labels:\r\n         Checking amount of labels for text fields... OK\r\n         Checking amount of labels for numeric fields... OK\r\n         Checking amount of labels for email fields... OK\r\n         Checking amount of labels for radio fields... OK\r\n         Checking amount of labels for select fields... OK\r\n         Checking amount of labels for check fields... OK\r\n         Checking amount of labels for textarea fields... OK\r\n\r\n      Question 2.10 [1 point] - Validating table:\r\n         Checking amount of columns... OK\r\n         Checking amount of merged columns... OK\r\n         Checking amount of labels within the first column... OK\r\n         Checking amount of labels within the second column... OK\r\n         Checking amount of labels within the third column... OK\r\n         Checking amount of labels within the fourth column... OK\r\n         Checking table's consistency... OK\r\n\r\n      Question 2.11 [1 point] - Validating form reset:\r\n         Checking amount of reset buttons... OK\r\n\r\n      Question 2.12 [1 point] - Validating form submit:\r\n         Checking amount of fields with no name... OK\r\n         Checking amount of submit buttons... OK\r\n         Checking form action... OK\r\n\r\n   Question 3 [2 points] - Checking menu (index.html):\r\n      Loading index.html... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 3.1 [1 point] - Validating lists:\r\n         Checking amount of lists... OK\r\n         Checking amount of list items... OK\r\n\r\n      Question 3.2 [1 point] - Validating links:\r\n         Checking amount of links... OK\r\n         Checking links destination... OK\r\n\r\n   TOTAL SCORE: 10 / 10\r\n\r\nRunning script DAM - M04 (UF1): HTML5 Assignment (v1.0.0.2):\r\n   Extracting files at: Student Name 1\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 2\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 3\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Starting the copy detector for HTML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n\r\n   Starting the copy detector for HTML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n\r\nRunning on batch mode for Student Name 2:\r\n   No potential copy detected for Student Name 2/index.html:\r\n      Match score with Student Name 1/index.html... 39,58 %\r\n      Match score with Student Name 3/index.html... 56,50 %\r\n\r\n   No potential copy detected for Student Name 2/contacte.html:\r\n      Match score with Student Name 1/contacte.html... 51,37 %\r\n      Match score with Student Name 3/contacte.html... 62,28 %\r\n\r\n   No potential copy has been detected.\r\n\r\n   Question 1 [4 points] - Checking index.html:\r\n      Looking for index.html... OK\r\n      Loading index.html... OK\r\n      Validating document against the W3C validation service... ERROR:\n         -Duplicate attribute alt.ight=\"333\"  alt=\"Cavs\">\r\n\r\n   Question 2 [12 points] - Checking contacte.html:\r\n      Looking for contacte.html... OK\r\n      Loading contacte.html... OK\r\n      Validating document against the W3C validation service... ERROR:\n         -Stray end tag label. teu nom\"></label></td>\r\n\r\n   Question 3 [2 points] - Checking menu (index.html):\r\n      Loading index.html... OK\r\n      Validating document against the W3C validation service... ERROR:\n         -Duplicate attribute alt.ight=\"333\"  alt=\"Cavs\">\r\n\r\n   TOTAL SCORE: 0 / 10\r\n\r\nRunning script DAM - M04 (UF1): HTML5 Assignment (v1.0.0.2):\r\n   Extracting files at: Student Name 1\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 2\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Extracting files at: Student Name 3\r\n      Extracting the file NULL... ERROR:\n      -Unable to use the connector named 'Compressed' because it couldn't be instantiated. \r\n      ---> Unable to find the specified file.\r\n\r\n   Starting the copy detector for HTML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n\r\n   Starting the copy detector for HTML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n\r\nRunning on batch mode for Student Name 3:\r\n   No potential copy detected for Student Name 3/index.html:\r\n      Match score with Student Name 1/index.html... 46,63 %\r\n      Match score with Student Name 2/index.html... 56,50 %\r\n\r\n   No potential copy detected for Student Name 3/contacte.html:\r\n      Match score with Student Name 1/contacte.html... 57,91 %\r\n      Match score with Student Name 2/contacte.html... 62,28 %\r\n\r\n   No potential copy has been detected.\r\n\r\n   Question 1 [4 points] - Checking index.html:\r\n      Looking for index.html... OK\r\n      Loading index.html... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 1.1 [1 point] - Validating headers:\r\n         Checking amount of level-1 headers... OK\r\n         Checking amount of level-2 headers... OK\r\n\r\n      Question 1.2 [1 point] - Validating paragraphs:\r\n         Checking amount of paragraphs... OK\r\n         Checking content legth within paragraphs... OK\r\n\r\n      Question 1.3 [1 point] - Validating breaklines:\r\n         Checking amount of breaklines within a paragraph... OK\r\n\r\n      Question 1.4 [1 point] - Validating images:\r\n         Checking amount of images... OK\r\n\r\n   Question 2 [12 points] - Checking contacte.html:\r\n      Looking for contacte.html... OK\r\n      Loading contacte.html... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 2.1 [1 point] - Validating text fields:\r\n         Checking amount of text fields... OK\r\n\r\n      Question 2.2 [1 point] - Validating numeric fields:\r\n         Checking amount of numeric fields... OK\r\n\r\n      Question 2.3 [1 point] - Validating email fields:\r\n         Checking amount of email fields... OK\r\n\r\n      Question 2.4 [1 point] - Validating radio fields:\r\n         Checking amount of radio fields... OK\r\n         Checking group for the radio fields... OK\r\n         Checking the checked radio fields... OK\r\n\r\n      Question 2.5 [1 point] - Validating select fields:\r\n         Checking amount of select fields... OK\r\n         Checking select options... OK\r\n         Checking the selected option... OK\r\n\r\n      Question 2.6 [1 point] - Validating checkbox fields:\r\n         Checking amount of checkbox fields... OK\r\n         Checking group for the checkbox fields... OK\r\n         Checking the checked option... OK\r\n\r\n      Question 2.7 [1 point] - Validating textarea fields:\r\n         Checking amount of textarea fields... OK\r\n\r\n      Question 2.8 [1 point] - Validating placeholders:\r\n         Checking amount of placelhoders for text fields... OK\r\n         Checking amount of placelhoders for email fields... OK\r\n         Checking amount of placelhoders for numeric fields... OK\r\n         Checking amount of placelhoders for textarea fields... OK\r\n\r\n      Question 2.9 [1 point] - Validating labels:\r\n         Checking amount of labels for text fields... OK\r\n         Checking amount of labels for numeric fields... OK\r\n         Checking amount of labels for email fields... OK\r\n         Checking amount of labels for radio fields... OK\r\n         Checking amount of labels for select fields... OK\r\n         Checking amount of labels for check fields... OK\r\n         Checking amount of labels for textarea fields... OK\r\n\r\n      Question 2.10 [1 point] - Validating table:\r\n         Checking amount of columns... OK\r\n         Checking amount of merged columns... OK\r\n         Checking amount of labels within the first column... OK\r\n         Checking amount of labels within the second column... OK\r\n         Checking amount of labels within the third column... OK\r\n         Checking amount of labels within the fourth column... OK\r\n         Checking table's consistency... OK\r\n\r\n      Question 2.11 [1 point] - Validating form reset:\r\n         Checking amount of reset buttons... OK\r\n\r\n      Question 2.12 [1 point] - Validating form submit:\r\n         Checking amount of fields with no name... OK\r\n         Checking amount of submit buttons... OK\r\n         Checking form action... OK\r\n\r\n   Question 3 [2 points] - Checking menu (index.html):\r\n      Loading index.html... OK\r\n      Validating document against the W3C validation service... OK\r\n\r\n      Question 3.1 [1 point] - Validating lists:\r\n         Checking amount of lists... OK\r\n         Checking amount of list items... OK\r\n\r\n      Question 3.2 [1 point] - Validating links:\r\n         Checking amount of links... OK\r\n         Checking links destination... OK\r\n\r\n   TOTAL SCORE: 10 / 10";
            Assert.AreEqual(expected, s.Output.ToString());
        }         
    }
}