/*
    Copyright Â© 2022 Fernando Porrino Serrano
    Third party software licenses can be found at /docs/credits/credits.md

    This file is part of AutoCheck.

    AutoCheck is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    AutoCheck is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with AutoCheck.  If not, see <https://www.gnu.org/licenses/>.
*/

using System.IO;
using NUnit.Framework;

namespace AutoCheck.Test
{    
    [Parallelizable(ParallelScope.All)]    
    public class RealXmlValidation : Test
    { 
        public RealXmlValidation(): base("script/real"){
        }        

        [Test, Category("FullScriptXml"), Category("Real"), Category("Local")]    
        public void Real_XML_SCRIPT_SINGLE_1() 
        {             
            var s = new AutoCheck.Core.Script(GetSampleFile("real_xml_single_1.yaml"));
            Assert.AreEqual("Running script 'DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD)' (v1.0.0.2):\r\nRunning on single mode for 'Student Name 1':\r\n   Question 1 [4 points] - Starting validation over file1.xml:\r\n      Looking for file1.xml... OK\r\n      Loading file1.xml... OK\r\n      Checking amount of nodes... OK\r\n      Checking node types... OK\r\n      Checking amount of attributes... OK\r\n      Checking attribute types... OK\r\n      Checking repeated nodes... OK\r\n\r\n      Question 1.1 [4 points] - Starting validation over file1.dtd:\r\n         Looking for file1.dtd... OK\r\n         Looking for comments... OK\r\n\r\n         Question 1.1.1 [2 points] - Content validation:\r\n            Checking document's content... OK\r\n\r\n         Question 1.1.2 [2 points] - Comments validation:\r\n            Checking document's comments... OK\r\n\r\n   Question 2 [4 points] - Starting validation over file2.xml:\r\n      Looking for file1.xml... OK\r\n      Loading file1.xml... OK\r\n      Looking for file2.xml... OK\r\n      Loading file2.xml... OK\r\n      Checking that file1.xml and file2.xml are using the same hierarchy... OK\r\n\r\n      Question 2.1 [4 points] - Starting validation over file2.xsd:\r\n         Looking for file2.xsd... OK\r\n         Loading file2.xsd... OK\r\n         Looking for comments... OK\r\n\r\n         Question 2.1.1 [2 points] - Content validation:\r\n            Checking document's content... OK\r\n\r\n         Question 2.1.2 [2 points] - Comments validation:\r\n            Checking document's comments... OK\r\n\r\n   Question 3 [2 points] - Starting validation over file3.xml:\r\n      Looking for file3.xml... OK\r\n      Loading file3.xml... OK\r\n      Looking for comments... OK\r\n\r\n      Question 3.1 [1 point] - Content validation:\r\n         Checking for a default namespace... OK\r\n         Checking for a custom namespaces... OK\r\n         Checking for a root node with using the default namespace... OK\r\n         Checking for the amount of nodes using the first namespace... OK\r\n         Checking for the amount of nodes using the second namespace... OK\r\n\r\n      Question 3.2 [1 point] - Comments validation:\r\n         Checking document's comments... OK\r\n\r\n   TOTAL SCORE: 10 / 10", s.Output.ToString());
        } 

        [Test, Category("FullScriptXml"), Category("Real"), Category("Local")]    
        public void Real_XML_SCRIPT_SINGLE_2()
        {             
            var s = new AutoCheck.Core.Script(GetSampleFile("real_xml_single_2.yaml"));                         
            Assert.AreEqual("Running script 'DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD)' (v1.0.0.2):\r\nRunning on single mode for 'Student Name 2':\r\n   Question 1 [4 points] - Starting validation over file1.xml:\r\n      Looking for file1.xml... OK\r\n      Loading file1.xml... OK\r\n      Checking amount of nodes... OK\r\n      Checking node types... OK\r\n      Checking amount of attributes... ERROR:\n         -Expected -> >=5; Found -> 3\r\n\r\n   Question 2 [4 points] - Starting validation over file2.xml:\r\n      Looking for file1.xml... OK\r\n      Loading file1.xml... OK\r\n      Looking for file2.xml... OK\r\n      Loading file2.xml... OK\r\n      Checking that file1.xml and file2.xml are using the same hierarchy... OK\r\n\r\n      Question 2.1 [4 points] - Starting validation over file2.xsd:\r\n         Looking for file2.xsd... OK\r\n         Loading file2.xsd... OK\r\n         Looking for comments... OK\r\n\r\n         Question 2.1.1 [2 points] - Content validation:\r\n            Checking document's content... OK\r\n\r\n         Question 2.1.2 [2 points] - Comments validation:\r\n            Checking document's comments... OK\r\n\r\n   Question 3 [2 points] - Starting validation over file3.xml:\r\n      Looking for file3.xml... OK\r\n      Loading file3.xml... OK\r\n      Looking for comments... OK\r\n\r\n      Question 3.1 [1 point] - Content validation:\r\n         Checking for a default namespace... OK\r\n         Checking for a custom namespaces... OK\r\n         Checking for a root node with using the default namespace... OK\r\n         Checking for the amount of nodes using the first namespace... ERROR:\n            -Expected -> =25; Found -> 24\r\n         Checking for the amount of nodes using the second namespace... ERROR:\n            -Expected -> =25; Found -> 24\r\n\r\n      Question 3.2 [1 point] - Comments validation:\r\n         Checking document's comments... OK\r\n\r\n   TOTAL SCORE: 5 / 10", s.Output.ToString());
        } 

        [Test, Category("FullScriptXml"), Category("Real"), Category("Local")]     
        public void Real_XML_SCRIPT_SINGLE_3()
        {              
            var s = new AutoCheck.Core.Script(GetSampleFile("real_xml_single_3.yaml"));                         
            Assert.AreEqual("Running script 'DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD)' (v1.0.0.2):\r\nRunning on single mode for 'Student Name 9':\r\n   Question 1 [4 points] - Starting validation over file1.xml:\r\n      Looking for file1.xml... OK\r\n      Loading file1.xml... OK\r\n      Checking amount of nodes... ERROR:\n         -Expected -> >=15; Found -> 13\r\n\r\n   Question 2 [4 points] - Starting validation over file2.xml:\r\n      Looking for file1.xml... OK\r\n      Loading file1.xml... OK\r\n      Looking for file2.xml... ERROR:\n         -Expected -> %file2.xml; Found -> NULL\r\n\r\n   Question 3 [2 points] - Starting validation over file3.xml:\r\n      Looking for file3.xml... ERROR:\n         -Expected -> %file3.xml; Found -> NULL\r\n\r\n   TOTAL SCORE: 0 / 10", s.Output.ToString());
        }   

        [Test, Category("FullScriptXml"), Category("Real"), Category("Local")]    
        public void Real_XML_SCRIPT_BATCH() 
        {                         
            var s = new AutoCheck.Core.Script(GetSampleFile("real_xml_batch.yaml"));   
            var expected = "Running script DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD) (v1.0.0.2):\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n      Looking for potential copies within Student Name 5... OK\r\n      Looking for potential copies within Student Name 6... OK\r\n      Looking for potential copies within Student Name 7... OK\r\n      Looking for potential copies within Student Name 8... OK\r\n      Looking for potential copies within Student Name 9... OK\r\n\r\nRunning on batch mode for Student Name 1:\r\n   Potential copy detected for Student Name 1/file1.xml:\r\n      Match score with Student Name 2/file1.xml... 68,00 %\r\n      Match score with Student Name 3/file1.xml... 41,95 %\r\n      Match score with Student Name 4/file1.xml... 41,95 %\r\n      Match score with Student Name 5/file1.xml... 41,86 %\r\n      Match score with Student Name 6/file1.xml... 42,00 %\r\n      Match score with Student Name 7/file1.xml... 41,85 %\r\n      Match score with Student Name 8/file1.xml... 41,69 %\r\n      Match score with Student Name 9/file1.xml... 43,24 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD) (v1.0.0.2):\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n      Looking for potential copies within Student Name 5... OK\r\n      Looking for potential copies within Student Name 6... OK\r\n      Looking for potential copies within Student Name 7... OK\r\n      Looking for potential copies within Student Name 8... OK\r\n      Looking for potential copies within Student Name 9... OK\r\n\r\nRunning on batch mode for Student Name 2:\r\n   Potential copy detected for Student Name 2/file1.xml:\r\n      Match score with Student Name 1/file1.xml... 68,00 %\r\n      Match score with Student Name 3/file1.xml... 36,42 %\r\n      Match score with Student Name 4/file1.xml... 36,42 %\r\n      Match score with Student Name 5/file1.xml... 36,40 %\r\n      Match score with Student Name 6/file1.xml... 36,16 %\r\n      Match score with Student Name 7/file1.xml... 36,37 %\r\n      Match score with Student Name 8/file1.xml... 36,44 %\r\n      Match score with Student Name 9/file1.xml... 37,60 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD) (v1.0.0.2):\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n      Looking for potential copies within Student Name 5... OK\r\n      Looking for potential copies within Student Name 6... OK\r\n      Looking for potential copies within Student Name 7... OK\r\n      Looking for potential copies within Student Name 8... OK\r\n      Looking for potential copies within Student Name 9... OK\r\n\r\nRunning on batch mode for Student Name 3:\r\n   Potential copy detected for Student Name 3/file1.xml:\r\n      Match score with Student Name 1/file1.xml... 41,95 %\r\n      Match score with Student Name 2/file1.xml... 36,42 %\r\n      Match score with Student Name 4/file1.xml... 100,00 %\r\n      Match score with Student Name 5/file1.xml... 80,48 %\r\n      Match score with Student Name 6/file1.xml... 80,80 %\r\n      Match score with Student Name 7/file1.xml... 81,12 %\r\n      Match score with Student Name 8/file1.xml... 81,12 %\r\n      Match score with Student Name 9/file1.xml... 78,10 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD) (v1.0.0.2):\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n      Looking for potential copies within Student Name 5... OK\r\n      Looking for potential copies within Student Name 6... OK\r\n      Looking for potential copies within Student Name 7... OK\r\n      Looking for potential copies within Student Name 8... OK\r\n      Looking for potential copies within Student Name 9... OK\r\n\r\nRunning on batch mode for Student Name 4:\r\n   Potential copy detected for Student Name 4/file1.xml:\r\n      Match score with Student Name 1/file1.xml... 41,95 %\r\n      Match score with Student Name 2/file1.xml... 36,42 %\r\n      Match score with Student Name 3/file1.xml... 100,00 %\r\n      Match score with Student Name 5/file1.xml... 80,48 %\r\n      Match score with Student Name 6/file1.xml... 80,80 %\r\n      Match score with Student Name 7/file1.xml... 81,12 %\r\n      Match score with Student Name 8/file1.xml... 81,12 %\r\n      Match score with Student Name 9/file1.xml... 78,10 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD) (v1.0.0.2):\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n      Looking for potential copies within Student Name 5... OK\r\n      Looking for potential copies within Student Name 6... OK\r\n      Looking for potential copies within Student Name 7... OK\r\n      Looking for potential copies within Student Name 8... OK\r\n      Looking for potential copies within Student Name 9... OK\r\n\r\nRunning on batch mode for Student Name 5:\r\n   Potential copy detected for Student Name 5/file1.xml:\r\n      Match score with Student Name 1/file1.xml... 41,86 %\r\n      Match score with Student Name 2/file1.xml... 36,40 %\r\n      Match score with Student Name 3/file1.xml... 80,48 %\r\n      Match score with Student Name 4/file1.xml... 80,48 %\r\n      Match score with Student Name 6/file1.xml... 81,82 %\r\n      Match score with Student Name 7/file1.xml... 81,85 %\r\n      Match score with Student Name 8/file1.xml... 81,62 %\r\n      Match score with Student Name 9/file1.xml... 78,50 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD) (v1.0.0.2):\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n      Looking for potential copies within Student Name 5... OK\r\n      Looking for potential copies within Student Name 6... OK\r\n      Looking for potential copies within Student Name 7... OK\r\n      Looking for potential copies within Student Name 8... OK\r\n      Looking for potential copies within Student Name 9... OK\r\n\r\nRunning on batch mode for Student Name 6:\r\n   Potential copy detected for Student Name 6/file1.xml:\r\n      Match score with Student Name 1/file1.xml... 42,00 %\r\n      Match score with Student Name 2/file1.xml... 36,16 %\r\n      Match score with Student Name 3/file1.xml... 80,80 %\r\n      Match score with Student Name 4/file1.xml... 80,80 %\r\n      Match score with Student Name 5/file1.xml... 81,82 %\r\n      Match score with Student Name 7/file1.xml... 82,86 %\r\n      Match score with Student Name 8/file1.xml... 81,85 %\r\n      Match score with Student Name 9/file1.xml... 78,39 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD) (v1.0.0.2):\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n      Looking for potential copies within Student Name 5... OK\r\n      Looking for potential copies within Student Name 6... OK\r\n      Looking for potential copies within Student Name 7... OK\r\n      Looking for potential copies within Student Name 8... OK\r\n      Looking for potential copies within Student Name 9... OK\r\n\r\nRunning on batch mode for Student Name 7:\r\n   Potential copy detected for Student Name 7/file1.xml:\r\n      Match score with Student Name 1/file1.xml... 41,85 %\r\n      Match score with Student Name 2/file1.xml... 36,37 %\r\n      Match score with Student Name 3/file1.xml... 81,12 %\r\n      Match score with Student Name 4/file1.xml... 81,12 %\r\n      Match score with Student Name 5/file1.xml... 81,85 %\r\n      Match score with Student Name 6/file1.xml... 82,86 %\r\n      Match score with Student Name 8/file1.xml... 81,25 %\r\n      Match score with Student Name 9/file1.xml... 77,96 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD) (v1.0.0.2):\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n      Looking for potential copies within Student Name 5... OK\r\n      Looking for potential copies within Student Name 6... OK\r\n      Looking for potential copies within Student Name 7... OK\r\n      Looking for potential copies within Student Name 8... OK\r\n      Looking for potential copies within Student Name 9... OK\r\n\r\nRunning on batch mode for Student Name 8:\r\n   Potential copy detected for Student Name 8/file1.xml:\r\n      Match score with Student Name 1/file1.xml... 41,69 %\r\n      Match score with Student Name 2/file1.xml... 36,44 %\r\n      Match score with Student Name 3/file1.xml... 81,12 %\r\n      Match score with Student Name 4/file1.xml... 81,12 %\r\n      Match score with Student Name 5/file1.xml... 81,62 %\r\n      Match score with Student Name 6/file1.xml... 81,85 %\r\n      Match score with Student Name 7/file1.xml... 81,25 %\r\n      Match score with Student Name 9/file1.xml... 86,82 %\r\n\r\n   Script execution aborted due potential copy detection.\r\n\r\nRunning script DAM - M04 (UF1): XML Validation Assignment (Namespaces + DTD + XSD) (v1.0.0.2):\r\n   Starting the copy detector for XML:\r\n      Looking for potential copies within Student Name 1... OK\r\n      Looking for potential copies within Student Name 2... OK\r\n      Looking for potential copies within Student Name 3... OK\r\n      Looking for potential copies within Student Name 4... OK\r\n      Looking for potential copies within Student Name 5... OK\r\n      Looking for potential copies within Student Name 6... OK\r\n      Looking for potential copies within Student Name 7... OK\r\n      Looking for potential copies within Student Name 8... OK\r\n      Looking for potential copies within Student Name 9... OK\r\n\r\nRunning on batch mode for Student Name 9:\r\n   Potential copy detected for Student Name 9/file1.xml:\r\n      Match score with Student Name 1/file1.xml... 43,24 %\r\n      Match score with Student Name 2/file1.xml... 37,60 %\r\n      Match score with Student Name 3/file1.xml... 78,10 %\r\n      Match score with Student Name 4/file1.xml... 78,10 %\r\n      Match score with Student Name 5/file1.xml... 78,50 %\r\n      Match score with Student Name 6/file1.xml... 78,39 %\r\n      Match score with Student Name 7/file1.xml... 77,96 %\r\n      Match score with Student Name 8/file1.xml... 86,82 %\r\n\r\n   Script execution aborted due potential copy detection.";                      
            Assert.AreEqual(expected, s.Output.ToString());
        }  
    }
}