# Copyright Â© 2020 Fernando Porrino Serrano
# Third party software licenses can be found at /docs/credits/thirdparties.md

# This file is part of AutoCheck.

# AutoCheck is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# AutoCheck is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.

# You should have received a copy of the GNU Affero General Public License
# along with AutoCheck.  If not, see <https://www.gnu.org/licenses/>.

name: "DAM - M04 (UF1): HTML5 Assignment"

body:
  - connector:            
      type: "Html"        
      arguments: "--folder {$CURRENT_FOLDER} --file index.html"       
        
  - question: 
      description: "Checking index.html"                          
      content:                            

        - run:
            connector: "Html"
            command:  "ValidateHTML5AgainstW3C"
            caption:  "Validating document against the W3C validation service... "
            onexception: "ABORT"

        - question:                     
            description: "Validating headers"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //h1"
                  caption:  "Checking amount of level-1 headers... "
                  expected: ">=1"

              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //h2"
                  caption:  "Checking amount of level-2 headers... "
                  expected: ">=1"

        - question:                     
            description: "Validating paragraphs"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //p"
                  caption:  "Checking amount of paragraphs... "
                  expected: ">=1"

              - run:
                  connector: "Html"
                  command:  "ContentLength"
                  arguments: "--xpath //p"
                  caption:  "Checking content legth within paragraphs... "
                  expected: ">=1500"

        - question:                     
            description: "Validating breaklines"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //p/br"
                  caption:  "Checking amount of breaklines... "
                  expected: ">=1"

        - question:                     
            description: "Validating images"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //img"
                  caption:  "Checking amount of images... "
                  expected: ">=1"   
                  
  - connector:            
      type: "Html"        
      arguments: "--folder {$CURRENT_FOLDER} --file contacte.html" 

  - question: 
      description: "Checking contacte.html"                          
      content:                            
        - run:
            connector: "Html"
            command:  "ValidateHTML5AgainstW3C"
            caption:  "Validating document against the W3C validation service... "
            onexception: "ABORT"
            
        - question:                     
            description: "Validating text fields"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='text']"
                  caption:  "Checking amount of text fields... "
                  expected: ">=2"              
        
              - vars:
                  amount_text: "{$RESULT}"

        - question:                     
            description: "Validating numeric fields"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='number']"
                  caption:  "Checking amount of numeric fields... "
                  expected: ">=1"            

              - vars:
                  amount_numeric: "{$RESULT}"

        - question:                     
            description: "Validating email fields"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='email']"
                  caption:  "Checking amount of email fields... "
                  expected: ">=1"
        
              - vars:
                  amount_email: "{$RESULT}"

        - question:                     
            description: "Validating radio fields"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='radio']"
                  caption:  "Checking amount of radio fields... "
                  expected: ">=3"   

              - vars:
                  amount_radio: "{$RESULT}"
                  
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='radio'][@name=(//input[@type='radio']/@name)]"
                  caption:  "Checking group for the radio fields... "
                  expected: ">=3" 

              - run:
                  connector: "Html"
                  command:  "CountSiblings"
                  arguments: "--xpath //input[@type='radio'][@checked]"
                  caption:  "Checking the checked radio fields... "
                  expected: "=1" 

        - question:                     
            description: "Validating select fields"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //select"
                  caption:  "Checking amount of select fields... "
                  expected: ">=1"   

              - vars:
                  amount_select: "{$RESULT}"
                  
              - run:
                  connector: "Html"
                  command:  "CountSiblings"
                  arguments: "--xpath //select/option"
                  caption:  "Checking select options... "
                  expected: ">=3" 

              - run:
                  connector: "Html"
                  command:  "CountSiblings"
                  arguments: "--xpath //select/option[@selected]"
                  caption:  "Checking the selected option... "
                  expected: "=1" 

        - question:                     
            description: "Validating checkbox fields"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='checkbox']"
                  caption:  "Checking amount of checkbox fields... "
                  expected: ">=3"  
                  
              - vars:
                  amount_check: "{$RESULT}"
                  
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='checkbox'][@name=(//input[@type='checkbox']/@name)]"
                  caption:  "Checking group for the checkbox fields... "
                  expected: ">=3" 

              - run:
                  connector: "Html"
                  command:  "CountSiblings"
                  arguments: "--xpath //input[@type='checkbox'][@checked]"
                  caption:  "Checking the checked option... "
                  expected: "=1" 

        - question:                     
            description: "Validating textarea fields"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //textarea"
                  caption:  "Checking amount of textarea fields... "
                  expected: ">=1"  
        
              - vars:
                  amount_textarea: "{$RESULT}"

        - question:                     
            description: "Validating placeholders"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='text'][@placeholder]"
                  caption:  "Checking amount of placelhoders for text fields... "
                  expected: "={$AMOUNT_TEXT}"   
                  
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='email'][@placeholder]"
                  caption:  "Checking amount of placelhoders for email fields... "
                  expected: "={$AMOUNT_EMAIL}" 

              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='number'][@placeholder]"
                  caption:  "Checking amount of placelhoders for numeric fields... "
                  expected: "={$AMOUNT_NUMBER}" 

              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //textarea[@placeholder]"
                  caption:  "Checking amount of placelhoders for textarea fields... "
                  expected: "={$AMOUNT_TEXTAREA}"

        - question:                     
            description: "Validating labels"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountRelatedLabels"
                  arguments: "--xpath //input[@type='text']"
                  caption:  "Checking amount of labels for text fields... "
                  expected: "={$AMOUNT_TEXT}"  
                  
              - run:
                  connector: "Html"
                  command:  "CountRelatedLabels"
                  arguments: "--xpath //input[@type='number']"
                  caption:  "Checking amount of labels for numeric fields... "
                  expected: "={$AMOUNT_NUMBER}" 

              - run:
                  connector: "Html"
                  command:  "CountRelatedLabels"
                  arguments: "--xpath //input[@type='email']"
                  caption:  "Checking amount of labels for email fields... "
                  expected: "={$AMOUNT_EMAIL}" 

              - run:
                  connector: "Html"
                  command:  "CountRelatedLabels"
                  arguments: "--xpath //input[@type='radio']"
                  caption:  "Checking amount of labels for radio fields... "
                  expected: "={$AMOUNT_RADIO}"

              - run:
                  connector: "Html"
                  command:  "CountRelatedLabels"
                  arguments: "--xpath //select"
                  caption:  "Checking amount of labels for select fields... "
                  expected: "={$AMOUNT_SELECT}"

              - run:
                  connector: "Html"
                  command:  "CountRelatedLabels"
                  arguments: "--xpath /input[@type='checkbox']"
                  caption:  "Checking amount of labels for check fields... "
                  expected: "={$AMOUNT_CHECK}"

              - run:
                  connector: "Html"
                  command:  "CountRelatedLabels"
                  arguments: "--xpath //textarea"
                  caption:  "Checking amount of labels for textarea fields... "
                  expected: "={$AMOUNT_TEXTAREA}"
               
        - question:                     
            description: "Validating table"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //tr[1]/td"
                  caption:  "Checking amount of columns... "
                  expected: ">=4"  
                  
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //td[@colspan=3]"
                  caption:  "Checking amount of merged columns... "
                  expected: "=>1" 

              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //tr/td[1]/label"
                  caption:  "Checking amount of labels within the first column... "
                  expected: "=>8" 

              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //tr/td[2]/label"
                  caption:  "Checking amount of labels within the second column... "
                  expected: "=>1"

              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //tr/td[3]/label"
                  caption:  "Checking amount of labels within the third column... "
                  expected: "=>5"

              - run:
                  connector: "Html"
                  command:  "ValidateTable"
                  arguments: "--xpath //table"
                  caption:  "Checking table's consistency... "
                  onexception: "ERROR"


        - question:                     
            description: "Validating form reset"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='reset'] | //button[@type='reset']"
                  caption:  "Checking amount of reset buttons... "
                  expected: ">=1"  

        - question:                     
            description: "Validating form submit"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath (//input[@type !='submit' and @type !='reset'] | //select | //textarea)[not(@name)]"
                  caption:  "Checking amount of fields with no name... "
                  expected: "=0"  

              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //input[@type='submit'] | //button[@type='submit']"
                  caption:  "Checking amount of submit buttons... "
                  expected: ">=1"  

              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //form[@action='formResult.html'] | //button[@formaction='formResult.html']"
                  caption:  "Checking form action... "
                  expected: "=1"  

  - connector:            
      type: "Html"        
      arguments: "--folder {$CURRENT_FOLDER} --file index.html"       
        
  - question: 
      description: "Checking menu (index.html)"
      content:                            
        
        - question:                     
            description: "Validating lists"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //ul"
                  caption:  "Checking amount of lists... "
                  expected: ">=1"

              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //ul/li"
                  caption:  "Checking amount of list items... "
                  expected: ">=2"

        - question:                     
            description: "Validating links"
            content:                            
              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //ul/li/a"
                  caption:  "Checking amount of links... "
                  expected: ">=2"

              - run:
                  connector: "Html"
                  command:  "CountNodes"
                  arguments: "--xpath //ul/li/a[@href='index.html' or @href='contacte.html']"
                  caption:  "Checking links destination... "
                  expected: ">=2"
       