# Copyright © 2020 Fernando Porrino Serrano
# Third party software licenses can be found at /docs/credits/thirdparties.md

# This file is part of AutoCheck.

# AutoCheck is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# AutoCheck is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.

# You should have received a copy of the GNU Affero General Public License
# along with AutoCheck.  If not, see <https://www.gnu.org/licenses/>.

#TODO: complete documentation with DocFX, commands and combination will be specidied as postgres documentation does (same syntax)

#The main idea of a batch-typed script is to iterate through a set of destinations and run a single-typed script over it, so inherits
#behaviour has been designed in order to allow the same code execution over a single target or a batch one.

inherits: "NONE"              #DEFAULT =  "NONE": Relative path to a YAML script file; any script can inherit from any other and overwrite whatever it needs.
batch:                        #OPTIONAL:  Batch mode definition, 'path' and 'folder' values can be combined with each other but not with the 'ip' one (cannot iterate through folders and IP addresses at the same time and using the same script code).  
  - copy_detector:            #OPTIONAL:  Enables the copy detection logic, not supported for "ip" targets.
      type: "TYPE"            #MANDATORY: The type of copy detector to use, allowed values are: [PLAINTEXT; SQLLOG; HTML; CSS]
      file: "*"               #DEFAULT = "*.ext": Which single file must be loaded into the copy-detector, being 'ext' the main extension for the current copy_detector; if multiple files matches with the given pattern, the first one will be taken and the other ones will be ignored.
      caption: "CAPTION"      #DEFAULT =  "Looking for potential copies within {#[^\\\\]+$$CURRENT_FOLDER}...": Message displayed before every check.
      threshold: !!float 0    #MANDATORY: The copy threshold to use, so results exceeding this value will be considered as a pontential copy.

  - target:                   #MANDATORY: At least one target must be specified
      - ip:     "IPADDRESS"   #OPTIONAL:  The script will be executed once for each defined IP address, multiples IPs can be defined and even ranges as 192.168.1.1/24; the current batch IP can be requested through the script with $CURRENT_IP
      - path:   "PATH"        #OPTIONAL:  The script will be executed once for each folder contained within the defined path; the current folder can be requested through the script with $CURRENT_FOLDER
      - folder: "FOLDER"      #OPTIONAL:  The script will be executed once for each folder defined; the current folder can be requested through the script with $CURRENT_FOLDER

#Script definition can be defined here exactly as single-typed script from this point, see single template for further details; however, inheriting from a single-typed script is strongly recommended.
#Recommended structure: main_script.yaml        ← as neutral so no folder or batch definition
#                        ∟ single_script.yaml   ← inherits and defines 'folder or ip' property
#                        ∟ batch_script.yaml    ← inherits and defines 'batch' property